

{% extends 'base.html' %}

{% block content %}
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyBGtxox2T1OKH_lnf-XPDnS7D9cZAkfZvU&"
            type="text/javascript"></script>


    <div class="container-body style-6">
        <div class="sf-map-container">
            <div class="sf-map-sidebar">

                {% for query in queryset_list %}

                    <div class="sf-map-results">
                        <div id= "{{ query.name }}" class="sf-map-result-container" style="border: none;">
                            <span class="sf-map-result-title">{{ query.name }}</span><br>
                            <span class="sf-map-result-addr">{{ query.address }}</span><br>
                            <span class="sf-map-result-phone">Phone: {{ query.phone }}</span><br>
                            <span class="sf-map-result-waitinglist">Waiting Time: {{ query.waitingTime }} months</span><br>
                            <a href={{ query.website }} class="sf-map-result-website">website</a>
                        </div>
                    </div>

                {% endfor %}

                {% if error_msg %}
                    <h2>Sorry, no results found.</h2>
                    <br>
                    <p>You can try to extend the limitation on distance to get results.</p>
                {% endif %}
            </div>

            <div class="sf-map-view" id="map">
                <div style="width: 100%;height: 100%;
                margin: 0px;
                padding: 0px;
                position: relative;"></div>


                <script type="text/javascript">

                    var locations = [];
                    var n = 1;

                    {% for query in queryset_list %}
                        locations.push(['{{ query.name }}', {{ query.lat }}, {{ query.lng }}, '{{ query.group }}', '{{ query.language}}',
                            '{{ query.monday }}', '{{ query.tuesday}}', '{{ query.wednesday }}', '{{ query.thursday }}',
                            '{{ query.friday}}', '{{ query.saturday}}', '{{ query.sunday }}', n]);
                        n = n + 1;
                    {% endfor %}

                    var map = new google.maps.Map(document.getElementById('map'), {
                        zoom: 10,
                        center: new google.maps.LatLng(-37.8136, 144.9631),
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    });

                    var infowindow = new google.maps.InfoWindow();

                    var marker;
                    var clicked = false;
                    var pMarkerId = '';

                    for (var i = 0; i < locations.length; i++) {
                        marker = new google.maps.Marker({
                            position: new google.maps.LatLng(locations[i][1], locations[i][2]),
                            map: map
                        });

                        google.maps.event.addListener(marker, 'click', (function (marker, i) {
                            return function () {
                                if (clicked) {
                                    document.getElementById(pMarkerId).style.border='none';
                                    clicked = false;
                                }
                                    infowindow.setContent("<strong>" + locations[i][0] + "</strong><br>" + '<br>' +
                                    "Patient Group: " + locations[i][3] + '<br>' + "Languages: " + locations[i][4] + '<br>'
                                    + '<br>' + "Opening Hours" +
                                    '<br>' + "Monday: " + locations[i][5] +
                                    '<br>' + "Tuesday: " + locations[i][6] +
                                    '<br>' + "Wednesday: " + locations[i][7] +
                                    '<br>' + "Thursday: " + locations[i][8] +
                                    '<br>' + "Fridayday: " + locations[i][9] +
                                    '<br>' + "Saturday: " + locations[i][10] +
                                    '<br>' + "Sunday: " + locations[i][11]);
                                infowindow.open(map, marker);
                                map.setZoom(14);
                                document.getElementById(locations[i][0]).style.border='solid red';
                                clicked = true;
                                pMarkerId = locations[i][0];

                            }
                        })(marker, i));
                    }

                </script>

            </div>

        </div>

    </div>


{% endblock %}